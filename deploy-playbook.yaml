---
- hosts: localhost

  collections:
  - kubernetes.core

  tasks:
  - name: Get a list of all pods from any namespace
    kubernetes.core.k8s_info:
      kind: Pod
      namespace: aap-app
    register: pod_list
  - name: Clone Deployment Configuration from GitHub
    git:
      repo: https://github.com/Ataloud-Projects/ataloudsite.git
      dest: /var/www/html
      version: main  # Specify the branch or tag if necessary
    register: git_clone_result
    
  - name: create k8s pod
    kubernetes.core.k8s:
      src: deployment/deployment.yaml
      namespace: aap-app
      state: present
    when: git_clone_result.changed

  - name: service create
    kubernetes.core.k8s:
      src: deployment/service.yaml
      namespace: aap-app
      state: present

  - name: route create
    kubernetes.core.k8s:
      src: deployment/route.yaml
      namespace: aap-app
      state: present